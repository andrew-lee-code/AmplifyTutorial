import time
from datetime import datetime

class APIUtils:

    @classmethod
    def get_update_params(cls, body):
        """Given a dictionary we generate an update expression and a dict of values
        to update a dynamodb table.

        Params:
            body (dict): Parameters to use for formatting.

        Returns:
            update expression, dict of values.
        """
        update_expression = ["set "]
        update_values = dict()

        for key, val in body.items():
            update_expression.append(f" {key} = :{key},")
            update_values[f":{key}"] = val


        update_expression, update_values = cls.__add_metadata(update_expression, update_values)

        return "".join(update_expression)[:-1], update_values


    def __add_metadata(update_expression, update_values):
        last_updated = int(time.time()) 
        update_expression.append(" updatedAt = :updatedAt,")
        update_values[f":updatedAt"] = datetime.utcfromtimestamp(last_updated).strftime('%Y-%m-%d %H:%M:%S')
        #update_expression.append(" _lastChangedAt = :lastChangedAt,")
        #update_values[f":lastChangedAt"] = datetime.utcfromtimestamp(last_updated).strftime('%Y-%m-%d %H:%M:%S')

        return update_expression, update_values